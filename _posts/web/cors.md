---
layout: single
title: "[Network] CORS란"
categories: web-network
tag: [Web, Network, CORS]
toc: true
toc_sticky: true
excerpt: ""
header:
  teaser: ../../images/2023-03-27-web-storage/web-storage-thumb.png
---

![web-storage-thumb.png](../../images/2023-03-27-web-storage/web-storage-thumb.png)

# 들어가기전

## 등장 배경

옛날에는 클라이언트가 동일한 서버에서만 리소스를 받았기 때문에, 리소스의 위험성에 대한 의심의 여지가 없었다. 웹 생태계가 다양화되면서 서로 다른 도메인 간에 데이터를 주고 받을 일이 많아졌다.

브라우저는 기본적으로 동일한 출처의 리소스만 허용하는데 (SOP), 이런 배경에서 다른 장치의 도입이 필요해졌다. 그래서, 서버끼리 합의된 출처 간 리소스 공유를 자유롭게 허용해주기 위해 만들어진 메커니즘이 CORS이다.

## 교차 출처의 위험성

브라우저는 사용자의 민감한 정보를 지니고 있기 때문에, 안전하게 보호 되어야 한다. 민감한 정보라고 하면 대표적으로 토큰이 있다. 토큰은 원격 서버에 접근 할 수 있는 인증 정보다. 만약, 브라우저에서 CORS가 비활성화 되어있다면 다음과 같은 최악의 시나리오를 생각해볼 수 있다.

내 브라우저는 페이스북에 로그인을 하여 토큰을 가지고 있다. 그리고 한 해커가 페이스북을 사칭하여 메일을 보내 hackerfacebook.com이라는 페이지의 링크를 보냈고 그 난 링크를 클릭했다. 이 페이지를 방문하면 페이스북 페이지 콘텐츠와 페이스북 인증 정보를 반환하는 요청을 하게되고 해커는 내 페이스북 계정으로 페이스북을 접속할 수 있게 된다.

# CORS

CORS는 HTTP 헤더에 CORS 관련 항목을 추가하여, 웹 어플리케이션이 출처가 다른 리소스에 접근이 가능하도록 브라우저에게 알려주는 체제이다.

# 출처란?

브라우저는 다음 3가지를 기준으로 출처가 같은지 아니면 다른지를 판단한다.

1. 프로토콜
2. 호스트
3. 포트 (보통 생략, 명시될 경우 일치해야 함)

이 3가지가 모두 같으면 동일 출처(Same Origin) 요청이고, 하나라도 다르면 교차 출처(Cross-origin) 요청이다. 교차 출처 요청을 할 경우, CORS 정책을 준수해야 정상적으로 응답을 받을 수 있다.

# CORS의 동작

1. Request (요청) : 클라이언트가 HTTP 헤더에 `Origin` 필드의 값으로 출처를 담아 요청을 보낸다.
2. Response (응답) : 서버가 헤더에 `Access-Control-Allow-Origin` 필드의 값으로 허용된 출처를 담아 응답을 보낸다.
3. Browser (브라우저) : 클라이언트의 브라우저는 `Origin` 값과 `Access-Control-Allow-Origin` 값을 비교해 유효한 응답인지 확인한다. 유효하지 않으면 응답을 사용하지 않는다.
